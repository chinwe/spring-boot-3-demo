# Application properties
server.port=8080

# h2 database
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# Async configuration
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-task-
spring.task.execution.pool.keep-alive=60s

# Async timeout settings
spring.mvc.async.request-timeout=30000

# JOOQ configuration - Auto execute SQL scripts
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema.sql

# ========== Resilience4j Configuration ==========

# Circuit Breaker Configuration
resilience4j.circuitbreaker.configs.default.sliding-window-size=100
resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=10
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.configs.default.slow-call-rate-threshold=50
resilience4j.circuitbreaker.configs.default.slow-call-duration-threshold=3s

# Circuit Breaker Instances
resilience4j.circuitbreaker.instances.externalApi.register-health-indicator=true
resilience4j.circuitbreaker.instances.externalApi.base-config=default

resilience4j.circuitbreaker.instances.apiRateLimiter.register-health-indicator=true
resilience4j.circuitbreaker.instances.apiRateLimiter.base-config=default

resilience4j.circuitbreaker.instances.apiBulkhead.register-health-indicator=true
resilience4j.circuitbreaker.instances.apiBulkhead.base-config=default

resilience4j.circuitbreaker.instances.apiTimeLimiter.register-health-indicator=true
resilience4j.circuitbreaker.instances.apiTimeLimiter.base-config=default

resilience4j.circuitbreaker.instances.combinedCircuitBreaker.register-health-indicator=true
resilience4j.circuitbreaker.instances.combinedCircuitBreaker.base-config=default

resilience4j.circuitbreaker.instances.combinedRateLimiter.register-health-indicator=true
resilience4j.circuitbreaker.instances.combinedRateLimiter.base-config=default

resilience4j.circuitbreaker.instances.combinedBulkhead.register-health-indicator=true
resilience4j.circuitbreaker.instances.combinedBulkhead.base-config=default

# Rate Limiter Configuration
resilience4j.ratelimiter.configs.default.limit-for-period=10
resilience4j.ratelimiter.configs.default.limit-refresh-period=1s
resilience4j.ratelimiter.configs.default.timeout-duration=5s

# Rate Limiter Instances
resilience4j.ratelimiter.instances.apiRateLimiter.register-health-indicator=true
resilience4j.ratelimiter.instances.apiRateLimiter.base-config=default

resilience4j.ratelimiter.instances.combinedRateLimiter.register-health-indicator=true
resilience4j.ratelimiter.instances.combinedRateLimiter.base-config=default

# Bulkhead Configuration
resilience4j.bulkhead.configs.default.max-concurrent-calls=10
resilience4j.bulkhead.configs.default.max-wait-duration=5s

# Bulkhead Instances
resilience4j.bulkhead.instances.apiBulkhead.register-health-indicator=true
resilience4j.bulkhead.instances.apiBulkhead.base-config=default

resilience4j.bulkhead.instances.combinedBulkhead.register-health-indicator=true
resilience4j.bulkhead.instances.combinedBulkhead.base-config=default

# Time Limiter Configuration
resilience4j.timelimiter.configs.default.timeout-duration=5s
resilience4j.timelimiter.configs.default.cancel-running-future=true

# Time Limiter Instances
resilience4j.timelimiter.instances.apiTimeLimiter.register-health-indicator=true
resilience4j.timelimiter.instances.apiTimeLimiter.base-config=default

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers,ratelimiters,bulkheads
management.endpoint.health.show-details=always

# Enable Cache for Rate Limiter
spring.cache.type=simple

# ========== Sentinel Configuration ==========

# Sentinel enabled flag
sentinel.enabled=true

# Sentinel Flow Control Configuration
sentinel.flow.default-qps=10
sentinel.flow.default-thread-count=5
sentinel.flow.warm-up-period=10
sentinel.flow.warm-up-steady-time=10000

# Sentinel Degrade Configuration
sentinel.degrade.default-min-request=5
sentinel.degrade.default-time-window=10
sentinel.degrade.default-slow-ratio=0.5
sentinel.degrade.default-exception-ratio=0.5
sentinel.degrade.slow-call-threshold-ms=500

# Sentinel System Rule Configuration
sentinel.system.max-cpu-usage=0.8
sentinel.system.max-rt=1000
sentinel.system.max-concurrency=20
sentinel.system.max-qps=1000

# Sentinel Metrics Configuration
sentinel.metric.statistic-interval-ms=1000
sentinel.metric.max-count=10000

# Sentinel Log Configuration
sentinel.log.switch=true
sentinel.log.dir=logs/sentinel
sentinel.log.file-name=metric.log
